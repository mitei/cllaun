print("--- Config: {APP_DIR}/.cllaun");

global.window = new Window();
window.id = "window";
window.frameLess = window.staysOnTop = window.translucentBackground = true;
global.commandLine = new LineEdit(window);
commandLine.id = "commandLine";
global.listView = new StringListView(window);
listView.id = "listView";

window.resize(1000, 1000);
window.move(300, 300);
window.show();
listView.move(16, 52);
listView.hide();

// Skin-api test
skin.read("test_skin");

// Global-Shortcut-api test
shortcut['Ctrl+Alt+Space'] = function() {
    window.show();
};

// (Widget-)Shortcut-api test
commandLine.shortcut['Esc'] = function() {
    window.hide();
}
commandLine.shortcut['Tab'] = function() {
    listView.setFocus();
    listView.index = 0;
};
listView.shortcut['Tab'] = function() {
    listView.index++;
};
listView.shortcut['Shift+Tab'] = function() {
    listView.index--;
};
listView.activated.connect(listView, function(i) {
    var cmd = parser.parse(commandLine.text);
    var subcmd = parser.parse(commandLine.text.substr(0, commandLine.cursorPosition));
    var newcmd = [cmd.name].concat(cmd.args);
    newcmd[subcmd.args.length] = this.data[i];
    commandLine.text = newcmd.join(' ');
    commandLine.setFocus();
    listView.hide();
});
listView.shortcut['Esc'] = listView.shortcut['Backspace'] = function() {
    commandLine.setFocus();
    listView.hide();
};

// Plugin-command test
launcher.commands['exit'] = exit;
launcher.commands['eval'] = eval;
launcher.aliases['!'] = ':eval';

// Alias-api test
launcher.aliases['quit'] = ':exit';

// signal-slot test
commandLine.returnPressed.connect(commandLine, function() {
    this.selectAll();
    window.hide();
    var cmd = parser.parse(this.text);
    launcher.run(cmd);
});
commandLine.textChanged.connect(commandLine, function() {
    var cmd = parser.parse(this.text.substr(0, this.cursorPosition));
    var candidates;
    if (cmd.args.length > 0) {
        candidates = launcher.list(cmd.args[cmd.args.length - 1]);
    } else {
        candidates = launcher.list(cmd.name);
    }

    listView.data = candidates;
    if (candidates.length == 0) {
        listView.hide();
    } else {
        listView.show();
    }
});

// Plugin-api test
plugin.importAll();

print("--- /Config: {APP_DIR}/.cllaun");
